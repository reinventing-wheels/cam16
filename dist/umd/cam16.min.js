((t,s)=>{"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s(t.cam16={})})(this,function(t){"use strict";const{abs:s,atan2:e,cbrt:n,cos:r,exp:i,hypot:o,log:c,max:h,min:_,sign:f,sin:u,sqrt:b,PI:l}=Math,{isFinite:F,isNaN:L,MAX_VALUE:w}=Number,N=l/180,A=180/l,M=[95.047,100,108.883],a=(t,s)=>{if(t[0]>s)return 0;if(s>t[t.length-1])return t.length;for(let e=1;t.length>e;e++){const n=t[e];if(s>=t[e-1]&&n>=s)return e}throw Error("wtf")},d=(t,n)=>{const i=(t.F_L*s(n[0])/100)**.42,c=(t.F_L*s(n[1])/100)**.42,h=(t.F_L*s(n[2])/100)**.42,_=400*f(n[0])*i/(i+27.13),u=400*f(n[1])*c/(c+27.13),l=400*f(n[2])*h/(h+27.13),F=_-12*u/11+l/11,L=_/9+u/9-2*l/9,w=_+u+21*l/20,M=(2*_+u+l/20)*t.N_bb;if(0>M)throw Error("CIECAM02 breakdown");const d=(A*e(L,F)+360)%360,p=(d-t.h[0])%360+t.h[0],m=(r(N*p+2)+3.8)/4,X=a(t.h,p)-1,g=t.e[X+1]*(p-t.h[X]),x=t.H[X]+100*g/(g+t.e[X]*(t.h[X+1]-p)),C=100*(M/t.A_w)**(t.c*t.z),Y=b(C/100),Z=4/t.c*Y*(t.A_w+4)*t.F_L**.25,y=(5e4/13*m*t.N_c*t.N_cb*o(F,L)/(w+.305))**.9*(1.64-.29**t.n)**.73,E=y*Y;return[C,E,x,d,E*t.F_L**.25,50*b(t.c*y/(t.A_w+4)),Z]},p=(t,e,n)=>{let i,o,c,h=0;if("J"===n[0]?o=4/t.c*b((i=e[0])/100)*(t.A_w+4)*t.F_L**.25:i=6.25*(t.c*(o=e[0])/(t.A_w+4)/t.F_L**.25)**2,"CM".includes(n[1])){let s,r;h=(t=>L(t)?0:F(t)?t:f(t)*w)(h=(r="M"===n[1]?(s=e[1])/t.F_L**.25:e[1])/b(i/100))}else{const s=e[1]/100;h=4*s*s*(t.A_w+4)/t.c}const _=(h/(1.64-.29**t.n)**.73)**(1/.9);if("h"===n[2])c=e[2];else{const s=e[2],n=a(t.H,s)-1,r=t.H[n],i=t.h[n],o=t.e[n],h=t.e[n+1];c=((s-r)*(h*i-o*t.h[n+1])-100*i*h)/((s-r)*(h-o)-100*h)%360}const l=12500*(r(N*c+2)+3.8)/13*t.N_c*t.N_cb,A=t.A_w*(i/100)**(1/t.c/t.z)/t.N_bb,M=u(N*c),d=r(N*c),p=23*(A+.305)*_/(23*l+11*_*d+108*_*M),m=p*d,X=p*M,g=(460*A+451*m+288*X)/1403,x=(460*A-891*m-261*X)/1403,C=(460*A-220*m-6300*X)/1403;return[100*f(g)/t.F_L*(27.13*s(g)/(400-s(g)))**(1/.42),100*f(x)/t.F_L*(27.13*s(x)/(400-s(x)))**(1/.42),100*f(C)/t.F_L*(27.13*s(C)/(400-s(C)))**(1/.42)]},m=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],X=[[1.86206786,-1.01125463,.14918677],[.38752654,.62144744,-.00897398],[-.0158415,-.03412294,1.04996444]],g=((t,s)=>e=>{for(let n=1;t.length>n;n++){const r=t[n-1],i=t[n];if(e>=r&&i>=e){const t=s[n-1];return t+(e-r)/(i-r)*(s[n]-t)}}throw Error("wtf")})([.525,.59,.69],[.8,.9,1]);class x{constructor(t=.69,s=20,e=64/l/5,r=M){const o=r[1],c=g(t);this.c=t,this.N_c=c;const f=1/(5*e+1),u=f*f*f*f,F=1-u;this.F_L=u*e+.1*F*F*n(5*e),this.n=s/o,this.z=1.48+b(this.n),this.N_bb=.725/this.n**.2,this.N_cb=this.N_bb;const L=m[0][0]*r[0]+m[0][1]*r[1]+m[0][2]*r[2],w=m[1][0]*r[0]+m[1][1]*r[1]+m[1][2]*r[2],N=m[2][0]*r[0]+m[2][1]*r[1]+m[2][2]*r[2],A=h(0,_(1,c*(1-1/3.6*i((-e-42)/92)))),a=A*o/L+1-A,d=A*o/w+1-A,p=A*o/N+1-A,x=(this.F_L*a*L/100)**.42,C=(this.F_L*d*w/100)**.42,Y=(this.F_L*p*N/100)**.42;this.A_w=(2*(400*x/(x+27.13)+.1)+400*C/(C+27.13)+.1+(400*Y/(Y+27.13)+.1)/20-.305)*this.N_bb,this.h=[20.14,90,164.25,237.53,380.14],this.e=[.8,.7,1,1.2,.8],this.H=[0,100,200,300,400],this.M聞=[[m[0][0]*a,m[0][1]*a,m[0][2]*a],[m[1][0]*d,m[1][1]*d,m[1][2]*d],[m[2][0]*p,m[2][1]*p,m[2][2]*p]],this.invM聞=[[X[0][0]/a,X[0][1]/d,X[0][2]/p],[X[1][0]/a,X[1][1]/d,X[1][2]/p],[X[2][0]/a,X[2][1]/d,X[2][2]/p]]}fromXYZ([t,s,e]){const[n,r,i]=this.M聞;return d(this,[n[0]*t+n[1]*s+n[2]*e,r[0]*t+r[1]*s+r[2]*e,i[0]*t+i[1]*s+i[2]*e])}toXYZ(t,s){const[e,n,r]=p(this,t,s),[i,o,c]=this.invM聞;return[i[0]*e+i[1]*n+i[2]*r,o[0]*e+o[1]*n+o[2]*r,c[0]*e+c[1]*n+c[2]*r]}}t.CAM16=x,t.CAM16UCS=class extends x{fromXYZ(t){const[s,,,e,n]=super.fromXYZ(t),i=(1+100*.007)*s/(1+.007*s)/1,o=1/.0228*c(1+.0228*n),h=N*e;return[i,o*r(h),o*u(h)]}toXYZ([t,s,n]){const r=1*t,c=r/(1-.007*(r-100)),h=A*e(n,s)%360,_=o(s,n),f=(i(.0228*_)-1)/.0228;return super.toXYZ([c,f,h],"JMh")}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=cam16.min.js.map
